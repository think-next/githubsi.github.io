<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title> Go 反射入门 | 渐行渐远</title>
  <meta name="description" content="Neojos Personal blog about everything">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta property="og:title" content="Go 反射入门" />
<meta property="og:description" content="通过下面的例子，我们来深入了解 reflect 数据包。我们定义People的结构体类型，来开始探索。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://neojos.com/blog/2021/go-%E5%8F%8D%E5%B0%84%E5%85%A5%E9%97%A8/" />
<meta property="article:published_time" content="2021-04-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2021-04-19T00:00:00+00:00" />

  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Go 反射入门"/>
<meta name="twitter:description" content="通过下面的例子，我们来深入了解 reflect 数据包。我们定义People的结构体类型，来开始探索。"/>

  
  
    
  
  
  <link rel="stylesheet" href="https://neojos.com/css/style-white.css">
  
  
  
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
<link rel="icon" type="image/png" href="https://neojos.com/images/favicon.ico" />

  
  
</head>

<body class="max-width mx-auto px3 ltr">
  <div class="content index py4">

    <header id="header">
  <a href="https://neojos.com/">
  
    <div id="logo" style="background-image: url(https://neojos.com/img/mifeng.jpeg)"></div>
  
  <div id="title">
    <h1>渐行渐远</h1>
  </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/blog">技术</a></li>
      
        <li><a href="/greatperson">生活</a></li>
      
    </ul>
  </div>
</header>



    
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <h1 id="title">Go 反射入门</h1>
  <div class="content" itemprop="articleBody">
  
    <p>通过下面的例子，我们来深入了解 <code>reflect</code> 数据包。我们定义<code>People</code>的结构体类型，来开始探索。</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span></span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span></span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span></span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span></span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#00f">type</span> <span style="color:#000">People</span> <span style="color:#00f">struct</span> {
<span style="display:block;width:100%;background-color:#e5e5e5">    <span style="color:#000">Age</span> <span style="color:#00f">int64</span>
</span>}
<span style="display:block;width:100%;background-color:#e5e5e5">
</span><span style="display:block;width:100%;background-color:#e5e5e5"><span style="color:#00f">func</span> <span style="color:#000">main</span>() {
</span><span style="display:block;width:100%;background-color:#e5e5e5">    <span style="color:#000">p</span> := &amp;<span style="color:#000">People</span>{
</span><span style="display:block;width:100%;background-color:#e5e5e5">        <span style="color:#000">Age</span>: <span style="color:#3af">30</span>,
</span>    }

  	<span style="color:#000">fmt</span>.<span style="color:#000">Println</span>(<span style="color:#000">reflect</span>.<span style="color:#000">ValueOf</span>(<span style="color:#000">p</span>).<span style="color:#000">Kind</span>())		<span style="color:#888;font-style:italic">// ouput: ptr
</span><span style="color:#888;font-style:italic"></span>    <span style="color:#000">value</span> := <span style="color:#000">reflect</span>.<span style="color:#000">Indirect</span>(<span style="color:#000">reflect</span>.<span style="color:#000">ValueOf</span>(<span style="color:#000">p</span>))
  	<span style="color:#000">fmt</span>.<span style="color:#000">Println</span>(<span style="color:#000">value</span>.<span style="color:#000">Kind</span>())		<span style="color:#888;font-style:italic">// output: struct
</span><span style="color:#888;font-style:italic"></span>}</code></pre></td></tr></table>
</div>
</div>
<p>上面这个例子，<code>reflect.Indirect</code> 返回的是底层的值类型，所以，调用<code>Kind</code>返回的类型为 <code>struct</code>。而它本身的 <code>Kind</code> 类型为<code>ptr</code>。查看源码中  <code>Kind</code> 的数据类型定义。通过这些常量的声明，可以帮助我们理解 Go 的基础类型。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// The zero Kind is not a valid kind.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Kind</span> <span style="color:#66d9ef">uint</span>

<span style="color:#66d9ef">const</span> (
	<span style="color:#a6e22e">Invalid</span> <span style="color:#a6e22e">Kind</span> = <span style="color:#66d9ef">iota</span>
	<span style="color:#a6e22e">Bool</span>
	<span style="color:#a6e22e">Int</span>
	<span style="color:#a6e22e">Int8</span>
	<span style="color:#a6e22e">Int16</span>
	<span style="color:#a6e22e">Int32</span>
	<span style="color:#a6e22e">Int64</span>
	<span style="color:#a6e22e">Uint</span>
	<span style="color:#a6e22e">Uint8</span>
	<span style="color:#a6e22e">Uint16</span>
	<span style="color:#a6e22e">Uint32</span>
	<span style="color:#a6e22e">Uint64</span>
	<span style="color:#a6e22e">Uintptr</span>
	<span style="color:#a6e22e">Float32</span>
	<span style="color:#a6e22e">Float64</span>
	<span style="color:#a6e22e">Complex64</span>
	<span style="color:#a6e22e">Complex128</span>
	<span style="color:#a6e22e">Array</span>
	<span style="color:#a6e22e">Chan</span>
	<span style="color:#a6e22e">Func</span>
	<span style="color:#a6e22e">Interface</span>
	<span style="color:#a6e22e">Map</span>
	<span style="color:#a6e22e">Ptr</span>
	<span style="color:#a6e22e">Slice</span>
	<span style="color:#a6e22e">String</span>
	<span style="color:#a6e22e">Struct</span>
	<span style="color:#a6e22e">UnsafePointer</span>
)
</code></pre></div><p>反射的 <code>ValueOf</code> 和 <code>TypeOf</code>是应用反射的入口，对应于接口类型的具体值和它的动态类型。下面这个例子中，我们拿<code>People</code>对象<code>Value</code>的<code>Type</code>和直接获取的<code>Type</code>做比较，输出值是相同的。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> 		<span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">People</span>{
        <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">30</span>,
    }

    <span style="color:#a6e22e">valueType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">Type</span>()
    <span style="color:#a6e22e">dynamicType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">p</span>)
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">valueType</span> <span style="color:#f92672">==</span> <span style="color:#a6e22e">dynamicType</span> {
      	<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;equal&#34;</span>)		<span style="color:#75715e">// output: equal
</span><span style="color:#75715e"></span>    }
</code></pre></div><p>仅仅通过这个例子，我们还无法确定：Go 中其他数据类型 <code>Value</code>结果的<code>Type</code>和类型的<code>Type</code>一定是相等的。我们深入到源码层面上，发现两者的实现是有很大差异的。</p>
<p><code>TypeOf</code>的逻辑相对简单些，强转一个 <code>emptyInterface</code>类型，返回<code>emptyInterface</code>类型的<code>typ</code>属性。而 <code>ValueOf().Type()</code>就显得比较复杂。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// TypeOf returns the reflection Type that represents the dynamic type of i.
</span><span style="color:#75715e">// If i is a nil interface value, TypeOf returns nil.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">TypeOf</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">interface</span>{}) <span style="color:#a6e22e">Type</span> {
	<span style="color:#a6e22e">eface</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">*</span>(<span style="color:#f92672">*</span><span style="color:#a6e22e">emptyInterface</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">i</span>))
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">toType</span>(<span style="color:#a6e22e">eface</span>.<span style="color:#a6e22e">typ</span>)
}
</code></pre></div><p>下面是源码中 <code>Value</code>转<code>Type</code>的方法。示例代码中，方法运行到注释为<code>Easy case</code>的逻辑里就直接返回了，后续的其他逻辑并没有执行到。</p>
<p>疑问的是，<code>flagMethod</code>是如何设置到<code>v.flag</code>上的呢？</p>
<p>查看源码，通过<code>ValueOf</code>方法设置的<code>flag</code>是无法把<code>flagMethod</code>指定的<code>bit</code>位设置成1的。<code>flagMethod</code>的常量定义:<code>flagMethod      flag = 1 &lt;&lt; 9</code>，把1右移9位，在<code>reflect.ValueOf</code>中并没有做这样的逻辑处理。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Type returns v&#39;s type.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">v</span> <span style="color:#a6e22e">Value</span>) <span style="color:#a6e22e">Type</span>() <span style="color:#a6e22e">Type</span> {
	<span style="color:#a6e22e">f</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">flag</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">f</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		panic(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ValueError</span>{<span style="color:#e6db74">&#34;reflect.Value.Type&#34;</span>, <span style="color:#a6e22e">Invalid</span>})
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">f</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">flagMethod</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#75715e">// Easy case
</span><span style="color:#75715e"></span>		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>
	}

	<span style="color:#75715e">// Method value.
</span><span style="color:#75715e"></span>	<span style="color:#75715e">// v.typ describes the receiver, not the method type.
</span><span style="color:#75715e"></span>  <span style="color:#75715e">// 获取方法的下标
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">i</span> <span style="color:#f92672">:=</span> int(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">flag</span>) <span style="color:#f92672">&gt;&gt;</span> <span style="color:#a6e22e">flagMethodShift</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">Kind</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">Interface</span> {
		<span style="color:#75715e">// Method on interface.
</span><span style="color:#75715e"></span>		<span style="color:#a6e22e">tt</span> <span style="color:#f92672">:=</span> (<span style="color:#f92672">*</span><span style="color:#a6e22e">interfaceType</span>)(<span style="color:#a6e22e">unsafe</span>.<span style="color:#a6e22e">Pointer</span>(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>))
		<span style="color:#66d9ef">if</span> uint(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">&gt;=</span> uint(len(<span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">methods</span>)) {
			panic(<span style="color:#e6db74">&#34;reflect: internal error: invalid method index&#34;</span>)
		}
		<span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">tt</span>.<span style="color:#a6e22e">methods</span>[<span style="color:#a6e22e">i</span>]
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">typeOff</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">typ</span>)
	}
	<span style="color:#75715e">// Method on concrete type.
</span><span style="color:#75715e"></span>	<span style="color:#a6e22e">ms</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">exportedMethods</span>()
	<span style="color:#66d9ef">if</span> uint(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">&gt;=</span> uint(len(<span style="color:#a6e22e">ms</span>)) {
		panic(<span style="color:#e6db74">&#34;reflect: internal error: invalid method index&#34;</span>)
	}
	<span style="color:#a6e22e">m</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">ms</span>[<span style="color:#a6e22e">i</span>]
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">typeOff</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">mtyp</span>)
}
</code></pre></div><p>上述<code>Easy case</code>之后的逻辑该如何触发呢？</p>
<p>通过方法的名称，我们还是可以隐约猜测到，它可能是一个方法的 <code>Value</code>。我们给 <code>People</code>对象追加一个方法，获取方法的<code>Value</code>对象，然后通过这个对象获取<code>Type</code>。代码的调整如下：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">People</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Age</span> <span style="color:#66d9ef">int64</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">p</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">People</span>) <span style="color:#a6e22e">Describe</span>() {
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#e6db74">&#34;people age:&#34;</span>, <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Age</span>)
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
    <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">People</span>{
        <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">30</span>,
    }

    <span style="color:#a6e22e">methodType</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">reflect</span>.<span style="color:#a6e22e">ValueOf</span>(<span style="color:#a6e22e">p</span>).<span style="color:#a6e22e">MethodByName</span>(<span style="color:#e6db74">&#34;Describe&#34;</span>).
        <span style="color:#a6e22e">Type</span>()
    <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Println</span>(<span style="color:#a6e22e">methodType</span>)
}
</code></pre></div><p>通过断点调试，这样处理后，确实触发了<code>Easy case</code>之后的逻辑。</p>
<p>那么，<code>MethodByName</code>具体做了什么操作呢？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// MethodByName returns a function value corresponding to the method
</span><span style="color:#75715e">// of v with the given name.
</span><span style="color:#75715e">// The arguments to a Call on the returned function should not include
</span><span style="color:#75715e">// a receiver; the returned function will always use v as the receiver.
</span><span style="color:#75715e">// It returns the zero Value if no method was found.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">v</span> <span style="color:#a6e22e">Value</span>) <span style="color:#a6e22e">MethodByName</span>(<span style="color:#a6e22e">name</span> <span style="color:#66d9ef">string</span>) <span style="color:#a6e22e">Value</span> {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ValueError</span>{<span style="color:#e6db74">&#34;reflect.Value.MethodByName&#34;</span>, <span style="color:#a6e22e">Invalid</span>})
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">flag</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">flagMethod</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Value</span>{}
	}
	<span style="color:#a6e22e">m</span>, <span style="color:#a6e22e">ok</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">MethodByName</span>(<span style="color:#a6e22e">name</span>)
	<span style="color:#66d9ef">if</span> !<span style="color:#a6e22e">ok</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Value</span>{}
	}
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">Method</span>(<span style="color:#a6e22e">m</span>.<span style="color:#a6e22e">Index</span>)
}
</code></pre></div><p>在 <code>Method</code>方法中，重新创建了返回的<code>Value</code>,并对 <code>flag</code>做好了标志位。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Method returns a function value corresponding to v&#39;s i&#39;th method.
</span><span style="color:#75715e">// The arguments to a Call on the returned function should not include
</span><span style="color:#75715e">// a receiver; the returned function will always use v as the receiver.
</span><span style="color:#75715e">// Method panics if i is out of range or if v is a nil interface value.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">v</span> <span style="color:#a6e22e">Value</span>) <span style="color:#a6e22e">Method</span>(<span style="color:#a6e22e">i</span> <span style="color:#66d9ef">int</span>) <span style="color:#a6e22e">Value</span> {
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ValueError</span>{<span style="color:#e6db74">&#34;reflect.Value.Method&#34;</span>, <span style="color:#a6e22e">Invalid</span>})
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">flag</span><span style="color:#f92672">&amp;</span><span style="color:#a6e22e">flagMethod</span> <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> <span style="color:#f92672">||</span> uint(<span style="color:#a6e22e">i</span>) <span style="color:#f92672">&gt;=</span> uint(<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">NumMethod</span>()) {
		panic(<span style="color:#e6db74">&#34;reflect: Method index out of range&#34;</span>)
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>.<span style="color:#a6e22e">Kind</span>() <span style="color:#f92672">==</span> <span style="color:#a6e22e">Interface</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">IsNil</span>() {
		panic(<span style="color:#e6db74">&#34;reflect: Method on nil interface value&#34;</span>)
	}
	<span style="color:#a6e22e">fl</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">flag</span>.<span style="color:#a6e22e">ro</span>() | (<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">flag</span> <span style="color:#f92672">&amp;</span> <span style="color:#a6e22e">flagIndir</span>)
	<span style="color:#a6e22e">fl</span> <span style="color:#f92672">|=</span> <span style="color:#a6e22e">flag</span>(<span style="color:#a6e22e">Func</span>)
	<span style="color:#a6e22e">fl</span> <span style="color:#f92672">|=</span> <span style="color:#a6e22e">flag</span>(<span style="color:#a6e22e">i</span>)<span style="color:#f92672">&lt;&lt;</span><span style="color:#a6e22e">flagMethodShift</span> | <span style="color:#a6e22e">flagMethod</span>
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">Value</span>{<span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">typ</span>, <span style="color:#a6e22e">v</span>.<span style="color:#a6e22e">ptr</span>, <span style="color:#a6e22e">fl</span>}
}
</code></pre></div>
  
  </div>
</article>


    <footer id="footer">
  <div class="footer-left">
    Copyright  &copy; 2021  渐行渐远 
  </div>
  <div class="footer-right">
    <nav>
      <ul>
         
        <li><a href="/">主页</a></li>
         
        <li><a href="/blog">技术</a></li>
         
        <li><a href="/greatperson">生活</a></li>
        
      </ul>
    </nav>
  </div>
</footer>


  </div>
</body>

<link rel="stylesheet" href=/lib/font-awesome/css/all.min.css>
<script src=/lib/jquery/jquery.min.js></script>
<script src=/js/main.js></script>
</html>
